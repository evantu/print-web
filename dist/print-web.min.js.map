{"version":3,"file":"print-web.min.js","sources":["../src/p.ts","../src/iframe.ts","../src/main.ts"],"sourcesContent":["import { Iframe } from \"./iframe\";\r\n\r\nexport interface Params {\r\n  id: string;\r\n  title?: string;\r\n}\r\nexport default class P {\r\n  constructor(private ifr: Iframe) {\r\n    this.ifr.cloneToIframe();\r\n    this.print();\r\n  }\r\n\r\n  checkIdIsEmpty(e: string) :void {\r\n    if (!e) console.error(\"id 不能为空\");\r\n  }\r\n\r\n  print(): void {\r\n    this.ifr.print();\r\n  }\r\n}\r\n","import { Params } from \"./p\";\r\nimport init from \"./main\";\r\n\r\nexport class Iframe {\r\n  iframe: HTMLFrameElement;\r\n  printPage: HTMLElement | null;\r\n  iframeId: string;\r\n  constructor(private config: Params) {\r\n    console.log(config);\r\n    this.iframe = this.createIframe();\r\n    this.printPage = document.getElementById(this.config.id);\r\n    this.iframeId = this.config.id + \"-iframe\";\r\n  }\r\n\r\n  createIframe(): HTMLFrameElement {\r\n    const checkIframe = document.getElementById(\r\n      this.iframeId\r\n    ) as HTMLFrameElement;\r\n    if (!checkIframe) {\r\n      let printFrame = document.createElement(\"iframe\");\r\n      printFrame.setAttribute(\r\n        \"style\",\r\n        \"visibility: hidden; height: 0; width: 0; position: absolute;\"\r\n      );\r\n      printFrame.setAttribute(\"id\", this.iframeId);\r\n      printFrame.setAttribute(\"name\", this.iframeId);\r\n\r\n      // printFrame.srcdoc = `<html><head><title>${this.config.title}</title></head><body></body></html>`;\r\n\r\n      document.getElementsByTagName(\"body\")[0].appendChild(printFrame);\r\n      return document.getElementById(this.iframeId) as HTMLFrameElement;\r\n    }\r\n\r\n    return checkIframe;\r\n  }\r\n\r\n  cloneToIframe() {\r\n    console.log(this.iframeId);\r\n    if (this.printPage)\r\n      this.traverseNode(this.printPage, (ele: Element) => {\r\n        ele.setAttribute(\"p-style\", window.getComputedStyle(ele, null).cssText);\r\n      });\r\n    if (this.iframeId) {\r\n      // let printFrameObj= document.getElementById(this.config.iframeId).contentWindow;\r\n      const printFrameObj = this.iframe.contentWindow;\r\n      if (printFrameObj) {\r\n        const iframeBody = printFrameObj.document.getElementsByTagName(\r\n          \"body\"\r\n        )[0];\r\n\r\n        if (this.printPage && iframeBody && printFrameObj) {\r\n          iframeBody.innerHTML = \"\";\r\n          iframeBody.appendChild(this.printPage.cloneNode(true));\r\n        }\r\n      }\r\n    }\r\n    this.removeTempStyle();\r\n  }\r\n\r\n  // private cloneEle() {\r\n  //   // this.printPage.\r\n  // }\r\n\r\n  private removeTempStyle() {\r\n    if (this.printPage)\r\n      this.traverseNode(this.printPage, (ele: Element) => {\r\n        ele.removeAttribute(\"p-style\");\r\n      });\r\n\r\n    if (this.iframe.contentWindow) {\r\n      const iframePageEle = this.iframe.contentWindow.document.getElementById(\r\n        this.config.id\r\n      );\r\n      iframePageEle && this.traverseNode(iframePageEle, (ele: Element) => {\r\n        const pStyle = ele.getAttribute(\"p-style\")\r\n        pStyle && ele.setAttribute(\"style\", pStyle);\r\n        ele.removeAttribute(\"p-style\")\r\n      });\r\n    }\r\n  }\r\n\r\n  private traverseNode(ele: Element, next: (ele: Element) => void) {\r\n    next(ele);\r\n    if (ele.hasChildNodes()) {\r\n      for (const item of ele.children) {\r\n        // window.getComputedStyle(item, null)\r\n        // console.log(window.getComputedStyle(item, null).cssText)\r\n        this.traverseNode(item, next);\r\n      }\r\n    }\r\n  }\r\n\r\n  print(): void {\r\n    // console.log(123);\r\n    this.iframe.contentWindow && this.iframe.contentWindow.print();\r\n  }\r\n\r\n  private copyStyleToIframe(ele: HTMLElement, iframe: HTMLFrameElement) {}\r\n}\r\n","import P, { Params } from \"./p\";\r\nimport { Iframe } from './iframe';\r\nconst initConfig: Params = {\r\n\tid: \"print-web\",\r\n\ttitle: \"print page\"\r\n};\r\n\r\nfunction init(params: Params) {\r\n\tconst config = Object.assign(initConfig, params);\r\n\tconsole.log(config, initConfig)\r\n\treturn new P(new Iframe(config));\r\n}\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.p = init;\r\n}\r\n\r\nexport default init;"],"names":["P","[object Object]","ifr","this","cloneToIframe","print","e","console","error","Iframe","config","log","iframe","createIframe","printPage","document","getElementById","id","iframeId","checkIframe","printFrame","createElement","setAttribute","getElementsByTagName","appendChild","traverseNode","ele","window","getComputedStyle","cssText","printFrameObj","contentWindow","iframeBody","innerHTML","cloneNode","removeTempStyle","removeAttribute","iframePageEle","pStyle","getAttribute","next","hasChildNodes","item","children","initConfig","title","init","params","Object","assign","p"],"mappings":"MAMqBA,EACnBC,YAAoBC,GAAAC,SAAAD,EAClBC,KAAKD,IAAIE,gBACTD,KAAKE,QAGPJ,eAAeK,GACRA,GAAGC,QAAQC,MAAM,WAGxBP,QACEE,KAAKD,IAAIG,eCdAI,EAIXR,YAAoBS,GAAAP,YAAAO,EAClBH,QAAQI,IAAID,GACZP,KAAKS,OAAST,KAAKU,eACnBV,KAAKW,UAAYC,SAASC,eAAeb,KAAKO,OAAOO,IACrDd,KAAKe,SAAWf,KAAKO,OAAOO,GAAK,UAGnChB,eACE,MAAMkB,EAAcJ,SAASC,eAC3Bb,KAAKe,UAEP,IAAKC,EAAa,CAChB,IAAIC,EAAaL,SAASM,cAAc,UAWxC,OAVAD,EAAWE,aACT,QACA,gEAEFF,EAAWE,aAAa,KAAMnB,KAAKe,UACnCE,EAAWE,aAAa,OAAQnB,KAAKe,UAIrCH,SAASQ,qBAAqB,QAAQ,GAAGC,YAAYJ,GAC9CL,SAASC,eAAeb,KAAKe,UAGtC,OAAOC,EAGTlB,gBAME,GALAM,QAAQI,IAAIR,KAAKe,UACbf,KAAKW,WACPX,KAAKsB,aAAatB,KAAKW,UAAYY,IACjCA,EAAIJ,aAAa,UAAWK,OAAOC,iBAAiBF,EAAK,MAAMG,WAE/D1B,KAAKe,SAAU,CAEjB,MAAMY,EAAgB3B,KAAKS,OAAOmB,cAClC,GAAID,EAAe,CACjB,MAAME,EAAaF,EAAcf,SAASQ,qBACxC,QACA,GAEEpB,KAAKW,WAAakB,GAAcF,IAClCE,EAAWC,UAAY,GACvBD,EAAWR,YAAYrB,KAAKW,UAAUoB,WAAU,MAItD/B,KAAKgC,kBAOClC,kBAMN,GALIE,KAAKW,WACPX,KAAKsB,aAAatB,KAAKW,UAAYY,IACjCA,EAAIU,gBAAgB,aAGpBjC,KAAKS,OAAOmB,cAAe,CAC7B,MAAMM,EAAgBlC,KAAKS,OAAOmB,cAAchB,SAASC,eACvDb,KAAKO,OAAOO,IAEdoB,GAAiBlC,KAAKsB,aAAaY,EAAgBX,IACjD,MAAMY,EAASZ,EAAIa,aAAa,WAChCD,GAAUZ,EAAIJ,aAAa,QAASgB,GACpCZ,EAAIU,gBAAgB,cAKlBnC,aAAayB,EAAcc,GAEjC,GADAA,EAAKd,GACDA,EAAIe,gBACN,IAAK,MAAMC,KAAQhB,EAAIiB,SAGrBxC,KAAKsB,aAAaiB,EAAMF,GAK9BvC,QAEEE,KAAKS,OAAOmB,eAAiB5B,KAAKS,OAAOmB,cAAc1B,QAGjDJ,kBAAkByB,EAAkBd,KC/F9C,MAAMgC,EAAqB,CAC1B3B,GAAI,YACJ4B,MAAO,cAGR,SAASC,EAAKC,GACb,MAAMrC,EAASsC,OAAOC,OAAOL,EAAYG,GAEzC,OADAxC,QAAQI,IAAID,EAAQkC,GACb,IAAI5C,EAAE,IAAIS,EAAOC,IAGH,oBAAXiB,SACTA,OAAOuB,EAAIJ"}