{"version":3,"file":"print-web.min.js","sources":["../src/p.ts","../src/iframe.ts","../src/main.ts"],"sourcesContent":["import { Iframe } from \"./iframe\";\r\n\r\nexport interface Params {\r\n  id: string;\r\n  iframeId: string;\r\n  title?: string;\r\n}\r\nexport default class P {\r\n  constructor(private config: Params, private ifr: Iframe) {\r\n    this.ifr.cloneToIframe();\r\n    this.print();\r\n  }\r\n\r\n  checkIdIsEmpty(e: string) :void {\r\n    if (!e) console.error(\"id 不能为空\");\r\n  }\r\n\r\n  print(): void {\r\n    this.ifr.print();\r\n  }\r\n}\r\n","import { Params } from \"./p\";\r\nimport init from \"./main\";\r\n\r\nexport class Iframe {\r\n  iframe: HTMLFrameElement;\r\n  printPage: HTMLElement | null;\r\n  constructor(private config: Params) {\r\n    this.iframe = this.createIframe();\r\n    this.printPage = document.getElementById(this.config.id);\r\n  }\r\n\r\n  createIframe(): HTMLFrameElement {\r\n    const checkIframe = document.getElementById(\r\n      this.config.iframeId\r\n    ) as HTMLFrameElement;\r\n    if (!checkIframe) {\r\n      let printFrame = document.createElement(\"iframe\");\r\n      printFrame.setAttribute(\r\n        \"style\",\r\n        \"visibility: hidden; height: 0; width: 0; position: absolute;\"\r\n      );\r\n      printFrame.setAttribute(\"id\", this.config.iframeId);\r\n      printFrame.setAttribute(\"name\", this.config.iframeId);\r\n\r\n      // printFrame.srcdoc = `<html><head><title>${this.config.title}</title></head><body></body></html>`;\r\n\r\n      document.getElementsByTagName(\"body\")[0].appendChild(printFrame);\r\n      return document.getElementById(this.config.iframeId) as HTMLFrameElement;\r\n    }\r\n\r\n    return checkIframe;\r\n  }\r\n\r\n  cloneToIframe() {\r\n    console.log(this.printPage);\r\n    if (this.printPage)\r\n      this.traverseNode(this.printPage, (ele: Element) => {\r\n        ele.setAttribute(\"p-style\", window.getComputedStyle(ele, null).cssText);\r\n      });\r\n    if (this.config.iframeId) {\r\n      // let printFrameObj= document.getElementById(this.config.iframeId).contentWindow;\r\n      const printFrameObj = this.iframe.contentWindow;\r\n      if (printFrameObj) {\r\n        const iframeBody = printFrameObj.document.getElementsByTagName(\r\n          \"body\"\r\n        )[0];\r\n\r\n        if (this.printPage && iframeBody && printFrameObj) {\r\n          iframeBody.innerHTML = \"\";\r\n          iframeBody.appendChild(this.printPage.cloneNode(true));\r\n        }\r\n      }\r\n    }\r\n    this.removeTempStyle();\r\n  }\r\n\r\n  // private cloneEle() {\r\n  //   // this.printPage.\r\n  // }\r\n\r\n  private removeTempStyle() {\r\n    if (this.printPage)\r\n      this.traverseNode(this.printPage, (ele: Element) => {\r\n        ele.removeAttribute(\"p-style\");\r\n      });\r\n\r\n    if (this.iframe.contentWindow) {\r\n      const iframePageEle = this.iframe.contentWindow.document.getElementById(\r\n        this.config.id\r\n      );\r\n      iframePageEle && this.traverseNode(iframePageEle, (ele: Element) => {\r\n        const pStyle = ele.getAttribute(\"p-style\")\r\n        pStyle && ele.setAttribute(\"style\", pStyle);\r\n        ele.removeAttribute(\"p-style\")\r\n      });\r\n    }\r\n  }\r\n\r\n  private traverseNode(ele: Element, next: (ele: Element) => void) {\r\n    next(ele);\r\n    if (ele.hasChildNodes()) {\r\n      for (const item of ele.children) {\r\n        // window.getComputedStyle(item, null)\r\n        // console.log(window.getComputedStyle(item, null).cssText)\r\n        this.traverseNode(item, next);\r\n      }\r\n    }\r\n  }\r\n\r\n  print(): void {\r\n    // console.log(123);\r\n    this.iframe.contentWindow && this.iframe.contentWindow.print();\r\n  }\r\n\r\n  private copyStyleToIframe(ele: HTMLElement, iframe: HTMLFrameElement) {}\r\n}\r\n","import P, { Params } from \"./p\";\r\nimport { Iframe } from './iframe';\r\nconst initConfig: Params = {\r\n\tid: \"print-web\",\r\n\tiframeId: \"print-web-iframe\",\r\n\ttitle: \"print page\"\r\n};\r\n\r\nfunction init(params: Params) {\r\n\tconst config = Object.assign(initConfig, params);\r\n\treturn new P(config, new Iframe(config));\r\n}\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.p = init;\r\n}\r\n\r\nexport default init;"],"names":["P","[object Object]","config","ifr","this","cloneToIframe","print","e","console","error","Iframe","iframe","createIframe","printPage","document","getElementById","id","checkIframe","iframeId","printFrame","createElement","setAttribute","getElementsByTagName","appendChild","log","traverseNode","ele","window","getComputedStyle","cssText","printFrameObj","contentWindow","iframeBody","innerHTML","cloneNode","removeTempStyle","removeAttribute","iframePageEle","pStyle","getAttribute","next","hasChildNodes","item","children","initConfig","title","init","params","Object","assign","p"],"mappings":"MAOqBA,EACnBC,YAAoBC,EAAwBC,GAAxBC,YAAAF,EAAwBE,SAAAD,EAC1CC,KAAKD,IAAIE,gBACTD,KAAKE,QAGPL,eAAeM,GACRA,GAAGC,QAAQC,MAAM,WAGxBR,QACEG,KAAKD,IAAIG,eCfAI,EAGXT,YAAoBC,GAAAE,YAAAF,EAClBE,KAAKO,OAASP,KAAKQ,eACnBR,KAAKS,UAAYC,SAASC,eAAeX,KAAKF,OAAOc,IAGvDf,eACE,MAAMgB,EAAcH,SAASC,eAC3BX,KAAKF,OAAOgB,UAEd,IAAKD,EAAa,CAChB,IAAIE,EAAaL,SAASM,cAAc,UAWxC,OAVAD,EAAWE,aACT,QACA,gEAEFF,EAAWE,aAAa,KAAMjB,KAAKF,OAAOgB,UAC1CC,EAAWE,aAAa,OAAQjB,KAAKF,OAAOgB,UAI5CJ,SAASQ,qBAAqB,QAAQ,GAAGC,YAAYJ,GAC9CL,SAASC,eAAeX,KAAKF,OAAOgB,UAG7C,OAAOD,EAGThB,gBAME,GALAO,QAAQgB,IAAIpB,KAAKS,WACbT,KAAKS,WACPT,KAAKqB,aAAarB,KAAKS,UAAYa,IACjCA,EAAIL,aAAa,UAAWM,OAAOC,iBAAiBF,EAAK,MAAMG,WAE/DzB,KAAKF,OAAOgB,SAAU,CAExB,MAAMY,EAAgB1B,KAAKO,OAAOoB,cAClC,GAAID,EAAe,CACjB,MAAME,EAAaF,EAAchB,SAASQ,qBACxC,QACA,GAEElB,KAAKS,WAAamB,GAAcF,IAClCE,EAAWC,UAAY,GACvBD,EAAWT,YAAYnB,KAAKS,UAAUqB,WAAU,MAItD9B,KAAK+B,kBAOClC,kBAMN,GALIG,KAAKS,WACPT,KAAKqB,aAAarB,KAAKS,UAAYa,IACjCA,EAAIU,gBAAgB,aAGpBhC,KAAKO,OAAOoB,cAAe,CAC7B,MAAMM,EAAgBjC,KAAKO,OAAOoB,cAAcjB,SAASC,eACvDX,KAAKF,OAAOc,IAEdqB,GAAiBjC,KAAKqB,aAAaY,EAAgBX,IACjD,MAAMY,EAASZ,EAAIa,aAAa,WAChCD,GAAUZ,EAAIL,aAAa,QAASiB,GACpCZ,EAAIU,gBAAgB,cAKlBnC,aAAayB,EAAcc,GAEjC,GADAA,EAAKd,GACDA,EAAIe,gBACN,IAAK,MAAMC,KAAQhB,EAAIiB,SAGrBvC,KAAKqB,aAAaiB,EAAMF,GAK9BvC,QAEEG,KAAKO,OAAOoB,eAAiB3B,KAAKO,OAAOoB,cAAczB,QAGjDL,kBAAkByB,EAAkBf,KC5F9C,MAAMiC,EAAqB,CAC1B5B,GAAI,YACJE,SAAU,mBACV2B,MAAO,cAGR,SAASC,EAAKC,GACb,MAAM7C,EAAS8C,OAAOC,OAAOL,EAAYG,GACzC,OAAO,IAAI/C,EAAEE,EAAQ,IAAIQ,EAAOR,IAGX,oBAAXyB,SACTA,OAAOuB,EAAIJ"}