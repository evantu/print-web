{"version":3,"file":"print-web.js","sources":["../../src/p.ts","../../src/iframe.ts","../../src/main.ts"],"sourcesContent":["import { Iframe } from \"./iframe\";\r\n\r\nexport interface Params {\r\n  id: string;\r\n  title?: string;\r\n}\r\nexport default class P {\r\n  constructor(private ifr: Iframe) {\r\n    this.ifr.cloneToIframe();\r\n    this.print();\r\n  }\r\n\r\n  checkIdIsEmpty(e: string) :void {\r\n    if (!e) console.error(\"id 不能为空\");\r\n  }\r\n\r\n  print(): void {\r\n    this.ifr.print();\r\n  }\r\n}\r\n","import { Params } from \"./p\";\r\nimport init from \"./main\";\r\n\r\nexport class Iframe {\r\n  iframe: HTMLFrameElement;\r\n  printPage: HTMLElement | null;\r\n  iframeId: string;\r\n  constructor(private config: Params) {\r\n    console.log(config);\r\n    this.iframe = this.createIframe();\r\n    this.printPage = document.getElementById(this.config.id);\r\n    this.iframeId = this.config.id + \"-iframe\";\r\n  }\r\n\r\n  createIframe(): HTMLFrameElement {\r\n    const checkIframe = document.getElementById(\r\n      this.iframeId\r\n    ) as HTMLFrameElement;\r\n    if (!checkIframe) {\r\n      let printFrame = document.createElement(\"iframe\");\r\n      printFrame.setAttribute(\r\n        \"style\",\r\n        \"visibility: hidden; height: 0; width: 0; position: absolute;\"\r\n      );\r\n      printFrame.setAttribute(\"id\", this.iframeId);\r\n      printFrame.setAttribute(\"name\", this.iframeId);\r\n\r\n      // printFrame.srcdoc = `<html><head><title>${this.config.title}</title></head><body></body></html>`;\r\n\r\n      document.getElementsByTagName(\"body\")[0].appendChild(printFrame);\r\n      return document.getElementById(this.iframeId) as HTMLFrameElement;\r\n    }\r\n\r\n    return checkIframe;\r\n  }\r\n\r\n  cloneToIframe() {\r\n    console.log(this.iframeId);\r\n    if (this.printPage)\r\n      this.traverseNode(this.printPage, (ele: Element) => {\r\n        ele.setAttribute(\"p-style\", window.getComputedStyle(ele, null).cssText);\r\n      });\r\n    if (this.iframeId) {\r\n      // let printFrameObj= document.getElementById(this.config.iframeId).contentWindow;\r\n      const printFrameObj = this.iframe.contentWindow;\r\n      if (printFrameObj) {\r\n        const iframeBody = printFrameObj.document.getElementsByTagName(\r\n          \"body\"\r\n        )[0];\r\n\r\n        if (this.printPage && iframeBody && printFrameObj) {\r\n          iframeBody.innerHTML = \"\";\r\n          iframeBody.appendChild(this.printPage.cloneNode(true));\r\n        }\r\n      }\r\n    }\r\n    this.removeTempStyle();\r\n  }\r\n\r\n  // private cloneEle() {\r\n  //   // this.printPage.\r\n  // }\r\n\r\n  private removeTempStyle() {\r\n    if (this.printPage)\r\n      this.traverseNode(this.printPage, (ele: Element) => {\r\n        ele.removeAttribute(\"p-style\");\r\n      });\r\n\r\n    if (this.iframe.contentWindow) {\r\n      const iframePageEle = this.iframe.contentWindow.document.getElementById(\r\n        this.config.id\r\n      );\r\n      iframePageEle && this.traverseNode(iframePageEle, (ele: Element) => {\r\n        const pStyle = ele.getAttribute(\"p-style\")\r\n        pStyle && ele.setAttribute(\"style\", pStyle);\r\n        ele.removeAttribute(\"p-style\")\r\n      });\r\n    }\r\n  }\r\n\r\n  private traverseNode(ele: Element, next: (ele: Element) => void) {\r\n    next(ele);\r\n    if (ele.hasChildNodes()) {\r\n      for (const item of ele.children) {\r\n        // window.getComputedStyle(item, null)\r\n        // console.log(window.getComputedStyle(item, null).cssText)\r\n        this.traverseNode(item, next);\r\n      }\r\n    }\r\n  }\r\n\r\n  print(): void {\r\n    // console.log(123);\r\n    this.iframe.contentWindow && this.iframe.contentWindow.print();\r\n  }\r\n\r\n  private copyStyleToIframe(ele: HTMLElement, iframe: HTMLFrameElement) {}\r\n}\r\n","import P, { Params } from \"./p\";\r\nimport { Iframe } from './iframe';\r\nconst initConfig: Params = {\r\n\tid: \"print-web\",\r\n\ttitle: \"print page\"\r\n};\r\n\r\nfunction init(params: Params) {\r\n\tconst config = Object.assign(initConfig, params);\r\n\tconsole.log(config, initConfig)\r\n\treturn new P(new Iframe(config));\r\n}\r\n\r\nif (typeof window !== \"undefined\") {\r\n  window.p = init;\r\n}\r\n\r\nexport default init;"],"names":[],"mappings":";;MAMqB,CAAC;IACpB,YAAoB,GAAW;QAAX,QAAG,GAAH,GAAG,CAAQ;QAC7B,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC;QACzB,IAAI,CAAC,KAAK,EAAE,CAAC;KACd;IAED,cAAc,CAAC,CAAS;QACtB,IAAI,CAAC,CAAC;YAAE,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;KAClC;IAED,KAAK;QACH,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;KAClB;CACF;;;MChBY,MAAM;IAIjB,YAAoB,MAAc;QAAd,WAAM,GAAN,MAAM,CAAQ;QAChC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAClC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACzD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,EAAE,GAAG,SAAS,CAAC;KAC5C;IAED,YAAY;QACV,MAAM,WAAW,GAAG,QAAQ,CAAC,cAAc,CACzC,IAAI,CAAC,QAAQ,CACM,CAAC;QACtB,IAAI,CAAC,WAAW,EAAE;YAChB,IAAI,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAClD,UAAU,CAAC,YAAY,CACrB,OAAO,EACP,8DAA8D,CAC/D,CAAC;YACF,UAAU,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC7C,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;;YAI/C,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;YACjE,OAAO,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAqB,CAAC;SACnE;QAED,OAAO,WAAW,CAAC;KACpB;IAED,aAAa;QACX,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC3B,IAAI,IAAI,CAAC,SAAS;YAChB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,GAAY;gBAC7C,GAAG,CAAC,YAAY,CAAC,SAAS,EAAE,MAAM,CAAC,gBAAgB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC;aACzE,CAAC,CAAC;QACL,IAAI,IAAI,CAAC,QAAQ,EAAE;;YAEjB,MAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC;YAChD,IAAI,aAAa,EAAE;gBACjB,MAAM,UAAU,GAAG,aAAa,CAAC,QAAQ,CAAC,oBAAoB,CAC5D,MAAM,CACP,CAAC,CAAC,CAAC,CAAC;gBAEL,IAAI,IAAI,CAAC,SAAS,IAAI,UAAU,IAAI,aAAa,EAAE;oBACjD,UAAU,CAAC,SAAS,GAAG,EAAE,CAAC;oBAC1B,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;iBACxD;aACF;SACF;QACD,IAAI,CAAC,eAAe,EAAE,CAAC;KACxB;;;;IAMO,eAAe;QACrB,IAAI,IAAI,CAAC,SAAS;YAChB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,GAAY;gBAC7C,GAAG,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;aAChC,CAAC,CAAC;QAEL,IAAI,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE;YAC7B,MAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,cAAc,CACrE,IAAI,CAAC,MAAM,CAAC,EAAE,CACf,CAAC;YACF,aAAa,IAAI,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE,CAAC,GAAY;gBAC7D,MAAM,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,SAAS,CAAC,CAAA;gBAC1C,MAAM,IAAI,GAAG,CAAC,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;gBAC5C,GAAG,CAAC,eAAe,CAAC,SAAS,CAAC,CAAA;aAC/B,CAAC,CAAC;SACJ;KACF;IAEO,YAAY,CAAC,GAAY,EAAE,IAA4B;QAC7D,IAAI,CAAC,GAAG,CAAC,CAAC;QACV,IAAI,GAAG,CAAC,aAAa,EAAE,EAAE;YACvB,KAAK,MAAM,IAAI,IAAI,GAAG,CAAC,QAAQ,EAAE;;;gBAG/B,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;aAC/B;SACF;KACF;IAED,KAAK;;QAEH,IAAI,CAAC,MAAM,CAAC,aAAa,IAAI,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;KAChE;IAEO,iBAAiB,CAAC,GAAgB,EAAE,MAAwB,KAAI;CACzE;;;AChGD,MAAM,UAAU,GAAW;IAC1B,EAAE,EAAE,WAAW;IACf,KAAK,EAAE,YAAY;CACnB,CAAC;AAEF,SAAS,IAAI,CAAC,MAAc;IAC3B,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;IACjD,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAA;IAC/B,OAAO,IAAI,CAAC,CAAC,IAAI,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;CACjC;AAED,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;IACjC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC;CACjB;AAED;;;;"}